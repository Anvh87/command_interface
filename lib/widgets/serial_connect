import 'package:flutter/material.dart';
import 'package:command_interface/widgets/js_general';


class ConnectWidget extends StatefulWidget {
  const ConnectWidget({super.key});

  @override
  State<ConnectWidget> createState() => _ConnectWidgetState();
}

class _ConnectWidgetState extends State<ConnectWidget> {
  bool _isConnected = false;
  Text _textConnection = const Text('Disconnected');
  Icon _iconConnection = const Icon(Icons.usb_off, size: 18);

  void _toggleConnection() {
    setState(() {
      if (_isConnected) {
        if (callDisconnect()) {
          _textConnection = const Text('Disconnected');
          _iconConnection = const Icon(Icons.usb_off, size: 18);
          _isConnected = false;
        }
      } else {
        if (callConnect(9600)) {
          _textConnection = const Text("Connected");
          _iconConnection = const Icon(Icons.usb, size: 18);
          _isConnected = true;
        }
      }
    });
  }

  @override
  Widget build(BuildContext context) {
    return Row(
      mainAxisSize: MainAxisSize.min,
      children: [
        ElevatedButton.icon(
          icon: _iconConnection,
          label: _textConnection,
          onPressed: _toggleConnection,
        ),
      ],
    );
  }
}